<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#dc2626">
    <link rel="manifest" href="#" id="manifest-placeholder">
    <title>Chef Genius Pro - AI Recipe Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #dc2626;
            --primary-dark: #991b1b;
            --primary-light: #fecaca;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --border: #e5e7eb;
            --success: #059669;
            --warning: #d97706;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: var(--bg-primary);
            min-height: 100vh;
            position: relative;
        }

        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Auth Pages */
        .auth-page {
            display: flex;
            flex-direction: column;
            padding: 40px 24px;
            min-height: 100vh;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .app-logo {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 16px;
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.3);
        }

        .auth-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .auth-header p {
            color: var(--text-secondary);
            font-size: 15px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: var(--text-primary);
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.2s;
            background: var(--bg-primary);
            font-family: inherit;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-google {
            width: 100%;
            padding: 14px;
            background: white;
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .btn-google:hover {
            background: var(--bg-secondary);
            border-color: var(--text-secondary);
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 24px 0;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .divider span {
            padding: 0 16px;
        }

        .auth-footer {
            text-align: center;
            margin-top: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        /* Main App Layout */
        .app-header {
            padding: 20px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .app-header h1 {
            font-size: 20px;
            font-weight: 700;
        }

        .app-content {
            padding: 24px;
            padding-bottom: 100px;
        }

        /* Filter Chips */
        .filter-section {
            margin-bottom: 24px;
        }

        .filter-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .chips-container {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .chip {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-primary);
        }

        .chip:hover {
            border-color: var(--primary);
        }

        .chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Usage Badge */
        .usage-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .usage-card.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .usage-card.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .usage-info h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            opacity: 0.9;
        }

        .usage-info p {
            font-size: 13px;
            opacity: 0.8;
        }

        .usage-count {
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin-top: 12px;
        }

        /* Recipe Input */
        .recipe-input {
            margin-bottom: 24px;
        }

        .recipe-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 15px;
        }

        .recipe-input textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            min-height: 120px;
            resize: vertical;
            background: var(--bg-primary);
        }

        /* Recipe Display */
        .recipe-card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .recipe-header {
            margin-bottom: 20px;
        }

        .recipe-header h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .difficulty-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .difficulty-easy { background: #d1fae5; color: #065f46; }
        .difficulty-medium { background: #fef3c7; color: #92400e; }
        .difficulty-hard { background: var(--primary-light); color: var(--primary-dark); }

        .recipe-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .recipe-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .icon-btn {
            padding: 10px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .icon-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .icon-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .recipe-section {
            margin-bottom: 24px;
        }

        .recipe-section h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .recipe-section ul,
        .recipe-section ol {
            margin-left: 20px;
        }

        .recipe-section li {
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .nutrition-item {
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .nutrition-item strong {
            display: block;
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .nutrition-item span {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Loading */
        .loading-state {
            text-align: center;
            padding: 60px 24px;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* History & Favorites */
        .history-item, .favorite-item {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.2s;
        }

        .history-item:hover, .favorite-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .history-title h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .history-date {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .history-actions {
            display: flex;
            gap: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 80px 24px;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: var(--text-secondary);
        }

        /* Shopping List */
        .shopping-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .shopping-item.checked {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .shopping-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Meal Planner */
        .meal-planner {
            display: grid;
            gap: 16px;
        }

        .day-card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }

        .day-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .meal-slot {
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .meal-slot:hover {
            background: var(--primary-light);
        }

        .meal-slot.empty {
            border: 2px dashed var(--border);
            background: transparent;
            text-align: center;
            color: var(--text-secondary);
        }

        /* Timer */
        .timer-display {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 24px;
        }

        .timer-time {
            font-size: 56px;
            font-weight: 700;
            margin-bottom: 16px;
            font-variant-numeric: tabular-nums;
        }

        .timer-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .timer-btn {
            padding: 12px 24px;
            background: white;
            color: var(--primary);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timer-btn:hover {
            transform: scale(1.05);
        }

        /* Profile */
        .profile-card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }

        .profile-info h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .profile-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .plan-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .plan-badge.free {
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        .plan-badge.premium {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #78350f;
        }

        .plan-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .stat-item {
            text-align: center;
        }

        .stat-item h4 {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-item p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .btn-secondary {
            width: 100%;
            padding: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--bg-primary);
            border-top: 1px solid var(--border);
            display: none;
            padding: 8px 0;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
        }

        .bottom-nav.active {
            display: flex;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            text-decoration: none;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
        }

        .alert-error {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-secondary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .nutrition-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Splash Screen -->
        <div id="splash" class="page active">
            <div class="auth-page">
                <div class="auth-header">
                    <div class="app-logo">üë®‚Äçüç≥</div>
                    <h1>Chef Genius Pro</h1>
                    <p>Transform ingredients into delicious recipes with AI</p>
                </div>
                <button class="btn-primary" onclick="showPage('signup')">Get Started</button>
                <div class="auth-footer">
                    Already have an account? <a href="#" onclick="showPage('login'); return false;">Log In</a>
                </div>
            </div>
        </div>

        <!-- Sign Up -->
        <div id="signup" class="page">
            <div class="auth-page">
                <div class="auth-header">
                    <div class="app-logo">üë®‚Äçüç≥</div>
                    <h1>Create Account</h1>
                    <p>Join Chef Genius Pro today</p>
                </div>
                <button class="btn-google" onclick="signInWithGoogle()">
                    <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/><path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.961H.957C.347 6.175 0 7.55 0 9s.348 2.825.957 4.039l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.961L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/></svg>
                    Continue with Google
                </button>
                <div class="divider"><span>or</span></div>
                <form onsubmit="handleSignup(event)">
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" id="signup-email" required>
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" id="signup-password" required minlength="6">
                    </div>
                    <div class="input-group">
                        <label>Confirm Password</label>
                        <input type="password" id="signup-confirm" required>
                    </div>
                    <button type="submit" class="btn-primary">Sign Up</button>
                </form>
                <div class="auth-footer">
                    Already have an account? <a href="#" onclick="showPage('login'); return false;">Log In</a>
                </div>
            </div>
        </div>

        <!-- Login -->
        <div id="login" class="page">
            <div class="auth-page">
                <div class="auth-header">
                    <div class="app-logo">üë®‚Äçüç≥</div>
                    <h1>Welcome Back</h1>
                    <p>Log in to Chef Genius Pro</p>
                </div>
                <button class="btn-google" onclick="signInWithGoogle()">
                    <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/><path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.961H.957C.347 6.175 0 7.55 0 9s.348 2.825.957 4.039l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.961L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/></svg>
                    Continue with Google
                </button>
                <div class="divider"><span>or</span></div>
                <form onsubmit="handleLogin(event)">
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <button type="submit" class="btn-primary">Log In</button>
                </form>
                <div class="auth-footer">
                    Don't have an account? <a href="#" onclick="showPage('signup'); return false;">Sign Up</a>
                </div>
            </div>
        </div>

        <!-- Home -->
        <div id="home" class="page">
            <div class="app-header">
                <h1>Chef Genius Pro</h1>
            </div>
            <div class="app-content">
                <div id="usage-display"></div>
                
                <!-- Dietary Filters -->
                <div class="filter-section">
                    <h3>ü•ó Dietary Preferences</h3>
                    <div class="chips-container" id="dietary-chips"></div>
                </div>
                
                <!-- Cuisine Selector -->
                <div class="filter-section">
                    <h3>üåç Cuisine Type</h3>
                    <div class="chips-container" id="cuisine-chips"></div>
                </div>
                
                <!-- Difficulty Level -->
                <div class="filter-section">
                    <h3>üë®‚Äçüç≥ Difficulty</h3>
                    <div class="chips-container" id="difficulty-chips"></div>
                </div>
                
                <div class="recipe-input">
                    <label>What ingredients do you have?</label>
                    <textarea id="ingredients" placeholder="chicken, tomatoes, garlic, rice, olive oil..."></textarea>
                </div>
                <button id="generate-btn" class="btn-primary" onclick="generateRecipe()">‚ú® Generate Recipe</button>
                <div id="loading" class="loading-state" style="display: none;">
                    <div class="spinner"></div>
                    <p>Crafting your perfect recipe...</p>
                </div>
                <div id="recipe-output"></div>
            </div>
        </div>

        <!-- History -->
        <div id="history" class="page">
            <div class="app-header">
                <h1>Recipe History</h1>
            </div>
            <div class="app-content">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="history-search" placeholder="Search recipes..." oninput="filterHistory()">
                </div>
                <div id="history-list"></div>
            </div>
        </div>

        <!-- Favorites -->
        <div id="favorites" class="page">
            <div class="app-header">
                <h1>‚≠ê Favorites</h1>
            </div>
            <div class="app-content">
                <div id="favorites-list"></div>
            </div>
        </div>

        <!-- Shopping List -->
        <div id="shopping" class="page">
            <div class="app-header">
                <h1>üõí Shopping List</h1>
            </div>
            <div class="app-content">
                <div id="shopping-list"></div>
                <button class="btn-secondary" onclick="clearShoppingList()" style="margin-top: 16px;">Clear Checked Items</button>
            </div>
        </div>

        <!-- Meal Planner -->
        <div id="planner" class="page">
            <div class="app-header">
                <h1>üìÖ Weekly Meal Planner</h1>
            </div>
            <div class="app-content">
                <div class="meal-planner" id="meal-planner"></div>
            </div>
        </div>

        <!-- Timer -->
        <div id="timer" class="page">
            <div class="app-header">
                <h1>‚è≤Ô∏è Cooking Timer</h1>
            </div>
            <div class="app-content">
                <div class="timer-display">
                    <div class="timer-time" id="timer-display">00:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn" onclick="startTimer()">‚ñ∂Ô∏è Start</button>
                        <button class="timer-btn" onclick="pauseTimer()">‚è∏Ô∏è Pause</button>
                        <button class="timer-btn" onclick="resetTimer()">üîÑ Reset</button>
                    </div>
                </div>
                <div class="input-group">
                    <label>Set Timer (minutes)</label>
                    <input type="number" id="timer-input" value="25" min="1" max="180">
                </div>
                <div style="margin-top: 20px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">Quick Presets</h3>
                    <div class="chips-container">
                        <div class="chip" onclick="setTimerPreset(5)">5 min</div>
                        <div class="chip" onclick="setTimerPreset(10)">10 min</div>
                        <div class="chip" onclick="setTimerPreset(15)">15 min</div>
                        <div class="chip" onclick="setTimerPreset(25)">25 min</div>
                        <div class="chip" onclick="setTimerPreset(30)">30 min</div>
                        <div class="chip" onclick="setTimerPreset(45)">45 min</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile -->
        <div id="profile" class="page">
            <div class="app-header">
                <h1>Profile</h1>
            </div>
            <div class="app-content">
                <div id="profile-display"></div>
                <button class="btn-primary" onclick="showPage('upgrade')" style="margin-bottom: 16px;">‚≠ê Upgrade to Premium</button>
                <button class="btn-secondary" onclick="logout()">üö™ Log Out</button>
            </div>
        </div>

        <!-- Upgrade -->
        <div id="upgrade" class="page">
            <div class="app-header">
                <h1>Upgrade to Premium</h1>
            </div>
            <div class="app-content">
                <div class="pricing-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                    <div class="pricing-header">
                        <h2 style="color: white;">Premium Plan</h2>
                        <div class="price" style="color: white;">$11.44</div>
                        <div class="price-period" style="color: rgba(255,255,255,0.8);">per month</div>
                    </div>
                    <ul class="features-list" style="color: white;">
                        <li style="color: white;">‚úì 30 recipe generations per month</li>
                        <li style="color: white;">‚úì Advanced AI suggestions</li>
                        <li style="color: white;">‚úì Unlimited favorites</li>
                        <li style="color: white;">‚úì Shopping list export</li>
                        <li style="color: white;">‚úì Nutritional information</li>
                        <li style="color: white;">‚úì Weekly meal planner</li>
                        <li style="color: white;">‚úì Recipe sharing</li>
                        <li style="color: white;">‚úì Priority support</li>
                    </ul>
                    <button class="btn-primary" style="background: white; color: #667eea;" onclick="initiatePayment()">Subscribe Now</button>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav" id="bottom-nav">
            <div class="nav-item active" onclick="navigateTo('home', event)">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">Home</div>
            </div>
            <div class="nav-item" onclick="navigateTo('favorites', event)">
                <div class="nav-icon">‚≠ê</div>
                <div class="nav-label">Favorites</div>
            </div>
            <div class="nav-item" onclick="navigateTo('planner', event)">
                <div class="nav-icon">üìÖ</div>
                <div class="nav-label">Planner</div>
            </div>
            <div class="nav-item" onclick="navigateTo('shopping', event)">
                <div class="nav-icon">üõí</div>
                <div class="nav-label">Shopping</div>
            </div>
            <div class="nav-item" onclick="navigateTo('profile', event)">
                <div class="nav-icon">üë§</div>
                <div class="nav-label">Profile</div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Share Recipe</h2>
                <span class="modal-close" onclick="closeModal('share-modal')">√ó</span>
            </div>
            <div id="share-content"></div>
        </div>
    </div>

    <!-- Add to Planner Modal -->
    <div id="planner-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add to Meal Plan</h2>
                <span class="modal-close" onclick="closeModal('planner-modal')">√ó</span>
            </div>
            <div class="input-group">
                <label>Select Day</label>
                <select id="planner-day">
                    <option value="monday">Monday</option>
                    <option value="tuesday">Tuesday</option>
                    <option value="wednesday">Wednesday</option>
                    <option value="thursday">Thursday</option>
                    <option value="friday">Friday</option>
                    <option value="saturday">Saturday</option>
                    <option value="sunday">Sunday</option>
                </select>
            </div>
            <div class="input-group">
                <label>Meal Type</label>
                <select id="planner-meal">
                    <option value="breakfast">Breakfast</option>
                    <option value="lunch">Lunch</option>
                    <option value="dinner">Dinner</option>
                </select>
            </div>
            <button class="btn-primary" onclick="addToMealPlan()">Add to Plan</button>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDW8V2SjNITrA4LcdmeILh944mTbOKnM0c",
            authDomain: "rewarderhub.firebaseapp.com",
            projectId: "rewarderhub",
            storageBucket: "rewarderhub.appspot.com",
            messagingSenderId: "85965945106",
            appId: "1:85965945106:web:fa0a57d8968926e1041bcb",
            measurementId: "G-F2ERB5NGN0"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // App State
        let currentUser = null;
        let userProfile = null;
        let recipes = [];
        let favorites = [];
        let shoppingList = [];
        let mealPlan = {};
        let currentRecipe = null;
        
        // Filters
        let selectedDietary = [];
        let selectedCuisine = '';
        let selectedDifficulty = '';
        
        // Timer
        let timerInterval = null;
        let timerSeconds = 0;
        let timerDuration = 0;

        // Filter Options
        const dietaryOptions = ['Vegetarian', 'Vegan', 'Gluten-Free', 'Keto', 'Paleo', 'Dairy-Free', 'Nut-Free', 'Low-Carb'];
        const cuisineOptions = ['Italian', 'Mexican', 'Asian', 'Indian', 'Mediterranean', 'American', 'French', 'Thai'];
        const difficultyOptions = ['Easy', 'Medium', 'Hard'];

        // Initialize
        window.onload = function() {
            initializeFilters();
            requestNotificationPermission();
        };

        function requestNotificationPermission() {
            if ("Notification" in window && Notification.permission === "default") {
                Notification.requestPermission();
            }
        }

        function initializeFilters() {
            // Dietary
            const dietaryContainer = document.getElementById('dietary-chips');
            dietaryContainer.innerHTML = dietaryOptions.map(opt => 
                `<div class="chip" onclick="toggleDietary('${opt}')">${opt}</div>`
            ).join('');
            
            // Cuisine
            const cuisineContainer = document.getElementById('cuisine-chips');
            cuisineContainer.innerHTML = cuisineOptions.map(opt => 
                `<div class="chip" onclick="selectCuisine('${opt}')">${opt}</div>`
            ).join('');
            
            // Difficulty
            const difficultyContainer = document.getElementById('difficulty-chips');
            difficultyContainer.innerHTML = difficultyOptions.map(opt => 
                `<div class="chip" onclick="selectDifficulty('${opt}')">${opt}</div>`
            ).join('');
        }

        function toggleDietary(option) {
            const index = selectedDietary.indexOf(option);
            if (index > -1) {
                selectedDietary.splice(index, 1);
            } else {
                selectedDietary.push(option);
            }
            updateFilterUI();
        }

        function selectCuisine(option) {
            selectedCuisine = selectedCuisine === option ? '' : option;
            updateFilterUI();
        }

        function selectDifficulty(option) {
            selectedDifficulty = selectedDifficulty === option ? '' : option;
            updateFilterUI();
        }

        function updateFilterUI() {
            document.querySelectorAll('#dietary-chips .chip').forEach((chip, i) => {
                chip.classList.toggle('active', selectedDietary.includes(dietaryOptions[i]));
            });
            document.querySelectorAll('#cuisine-chips .chip').forEach((chip, i) => {
                chip.classList.toggle('active', selectedCuisine === cuisineOptions[i]);
            });
            document.querySelectorAll('#difficulty-chips .chip').forEach((chip, i) => {
                chip.classList.toggle('active', selectedDifficulty === difficultyOptions[i]);
            });
        }

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserProfile();
                await loadRecipes();
                await loadFavorites();
                await loadShoppingList();
                await loadMealPlan();
                showPage('home');
                updateUI();
            } else {
                currentUser = null;
                userProfile = null;
                recipes = [];
            }
        });

        async function loadUserProfile() {
            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                if (doc.exists) {
                    userProfile = doc.data();
                } else {
                    userProfile = {
                        email: currentUser.email,
                        plan: 'free',
                        generationsUsed: 0,
                        generationsLimit: 2,
                        joinDate: new Date().toISOString()
                    };
                    await db.collection('users').doc(currentUser.uid).set(userProfile);
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        async function loadRecipes() {
            try {
                const snapshot = await db.collection('recipes')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('date', 'desc')
                    .get();
                recipes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error('Error loading recipes:', error);
            }
        }

        async function loadFavorites() {
            try {
                const snapshot = await db.collection('favorites')
                    .where('userId', '==', currentUser.uid)
                    .get();
                favorites = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error('Error loading favorites:', error);
            }
        }

        async function loadShoppingList() {
            try {
                const doc = await db.collection('shopping').doc(currentUser.uid).get();
                shoppingList = doc.exists ? doc.data().items || [] : [];
            } catch (error) {
                console.error('Error loading shopping list:', error);
            }
        }

        async function loadMealPlan() {
            try {
                const doc = await db.collection('mealPlans').doc(currentUser.uid).get();
                mealPlan = doc.exists ? doc.data().plan || {} : {};
            } catch (error) {
                console.error('Error loading meal plan:', error);
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;

            if (password !== confirm) {
                alert('Passwords do not match!');
                return;
            }

            try {
                await auth.createUserWithEmailAndPassword(email, password);
            } catch (error) {
                alert(error.message);
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                alert(error.message);
            }
        }

        async function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
            } catch (error) {
                alert(error.message);
            }
        }

        async function logout() {
            if (confirm('Are you sure you want to log out?')) {
                try {
                    await auth.signOut();
                    showPage('splash');
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            const showNav = ['home', 'history', 'favorites', 'shopping', 'planner', 'timer', 'profile'].includes(pageId);
            document.getElementById('bottom-nav').classList.toggle('active', showNav);

            if (pageId === 'history') updateHistory();
            if (pageId === 'favorites') updateFavorites();
            if (pageId === 'shopping') updateShoppingList();
            if (pageId === 'planner') updateMealPlanner();
            if (pageId === 'profile') updateProfile();
        }

        function navigateTo(page, event) {
            event.currentTarget.parentElement.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            showPage(page);
        }

        function updateUI() {
            if (!userProfile) return;

            const remaining = userProfile.generationsLimit - userProfile.generationsUsed;
            const usageDiv = document.getElementById('usage-display');

            let cardClass = 'usage-card';
            if (remaining === 1) cardClass += ' warning';
            if (remaining === 0) cardClass += ' danger';

            usageDiv.innerHTML = `
                <div class="${cardClass}">
                    <div class="usage-info">
                        <h3>Recipe Credits</h3>
                        <p>${remaining} of ${userProfile.generationsLimit} remaining</p>
                    </div>
                    <div class="usage-count">${remaining}</div>
                </div>
            `;

            const genBtn = document.getElementById('generate-btn');
            genBtn.disabled = remaining === 0;
            if (remaining === 0) {
                genBtn.textContent = '‚≠ê Upgrade to Generate More';
                genBtn.onclick = () => showPage('upgrade');
            } else {
                genBtn.textContent = '‚ú® Generate Recipe';
                genBtn.onclick = generateRecipe;
            }
        }

        function generateAIRecipe(ingredients) {
            const ingredientList = ingredients.split(',').map(i => i.trim()).filter(i => i);
            const mainIngredient = ingredientList[0] || 'ingredient';
            
            const cuisinePrefix = selectedCuisine ? `${selectedCuisine} ` : '';
            const dishNames = [
                `${cuisinePrefix}${mainIngredient.charAt(0).toUpperCase() + mainIngredient.slice(1)} Bowl`,
                `${cuisinePrefix}${mainIngredient.charAt(0).toUpperCase() + mainIngredient.slice(1)} Delight`,
                `Chef's ${cuisinePrefix}${mainIngredient.charAt(0).toUpperCase() + mainIngredient.slice(1)}`,
                `Gourmet ${cuisinePrefix}${mainIngredient.charAt(0).toUpperCase() + mainIngredient.slice(1)}`
            ];
            
            const dishName = dishNames[Math.floor(Math.random() * dishNames.length)];
            const difficulty = selectedDifficulty || difficultyOptions[Math.floor(Math.random() * 3)];
            
            return {
                name: dishName,
                difficulty: difficulty,
                servings: '2-3 people',
                prepTime: '15-20 minutes',
                cookTime: '25-30 minutes',
                dietary: selectedDietary.join(', ') || 'None specified',
                cuisine: selectedCuisine || 'Fusion',
                ingredients: ingredientList.map(ing => `${Math.floor(Math.random() * 3) + 1} ${['cup', 'tbsp', 'tsp', 'piece'][Math.floor(Math.random() * 4)]} ${ing}`),
                instructions: [
                    `Prepare all ingredients: ${ingredientList.slice(0, 3).join(', ')}.`,
                    `Heat a large pan over medium heat with oil.`,
                    `Add main ingredients (${ingredientList.slice(0, 2).join(', ')}) and cook for 5-7 minutes.`,
                    `Season with salt, pepper, and your favorite spices.`,
                    `Add remaining ingredients: ${ingredientList.slice(2).join(', ') || 'seasonings'}.`,
                    `Cook for 15-20 minutes, stirring occasionally.`,
                    `Taste and adjust seasoning.`,
                    `Serve hot and enjoy!`
                ],
                nutrition: {
                    calories: Math.floor(Math.random() * 400) + 200,
                    protein: Math.floor(Math.random() * 30) + 10 + 'g',
                    carbs: Math.floor(Math.random() * 50) + 20 + 'g',
                    fat: Math.floor(Math.random() * 20) + 5 + 'g'
                },
                tips: `This ${dishName} pairs wonderfully with a fresh salad. ${selectedDietary.length > 0 ? 'Recipe adapted for ' + selectedDietary.join(', ') + ' diet.' : ''}`
            };
        }

        async function generateRecipe() {
            const ingredients = document.getElementById('ingredients').value.trim();

            if (!ingredients) {
                alert('Please enter some ingredients!');
                return;
            }

            if (userProfile.generationsUsed >= userProfile.generationsLimit) {
                showPage('upgrade');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('recipe-output').innerHTML = '';
            document.getElementById('generate-btn').disabled = true;

            setTimeout(async () => {
                try {
                    const recipe = generateAIRecipe(ingredients);
                    currentRecipe = recipe;
                    displayRecipe(recipe);

                    await db.collection('recipes').add({
                        userId: currentUser.uid,
                        ingredients,
                        recipe,
                        date: new Date().toISOString()
                    });

                    userProfile.generationsUsed++;
                    await db.collection('users').doc(currentUser.uid).update({
                        generationsUsed: userProfile.generationsUsed
                    });

                    await loadRecipes();
                    updateUI();

                } catch (error) {
                    console.error('Error generating recipe:', error);
                    alert('Failed to generate recipe. Please try again.');
                } finally {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('generate-btn').disabled = false;
                }
            }, 2000);
        }

        function displayRecipe(recipe) {
            const isFavorite = favorites.some(f => f.recipe.name === recipe.name);
            const output = document.getElementById('recipe-output');
            output.innerHTML = `
                <div class="recipe-card">
                    <div class="recipe-header">
                        <h2>üçΩÔ∏è ${recipe.name}</h2>
                        <span class="difficulty-badge difficulty-${recipe.difficulty.toLowerCase()}">${recipe.difficulty}</span>
                        <div class="recipe-meta">
                            <div class="meta-item">üë• ${recipe.servings}</div>
                            <div class="meta-item">‚è±Ô∏è ${recipe.prepTime}</div>
                            <div class="meta-item">üî• ${recipe.cookTime}</div>
                        </div>
                        <div class="recipe-meta">
                            <div class="meta-item">ü•ó ${recipe.dietary}</div>
                            <div class="meta-item">üåç ${recipe.cuisine}</div>
                        </div>
                    </div>
                    
                    <div class="recipe-actions">
                        <button class="icon-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite(currentRecipe)">
                            ${isFavorite ? '‚≠ê' : '‚òÜ'} Favorite
                        </button>
                        <button class="icon-btn" onclick="addToShopping(currentRecipe)">
                            üõí Shopping
                        </button>
                        <button class="icon-btn" onclick="openPlannerModal(currentRecipe)">
                            üìÖ Plan
                        </button>
                        <button class="icon-btn" onclick="shareRecipe(currentRecipe)">
                            üì§ Share
                        </button>
                    </div>
                    
                    <div class="recipe-section">
                        <h3>üìã Ingredients</h3>
                        <ul>
                            ${recipe.ingredients.map(i => `<li>${i}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="recipe-section">
                        <h3>üë®‚Äçüç≥ Instructions</h3>
                        <ol>
                            ${recipe.instructions.map(i => `<li>${i}</li>`).join('')}
                        </ol>
                    </div>
                    
                    <div class="recipe-section">
                        <h3>üìä Nutritional Information</h3>
                        <div class="nutrition-grid">
                            <div class="nutrition-item">
                                <strong>${recipe.nutrition.calories}</strong>
                                <span>Calories</span>
                            </div>
                            <div class="nutrition-item">
                                <strong>${recipe.nutrition.protein}</strong>
                                <span>Protein</span>
                            </div>
                            <div class="nutrition-item">
                                <strong>${recipe.nutrition.carbs}</strong>
                                <span>Carbs</span>
                            </div>
                            <div class="nutrition-item">
                                <strong>${recipe.nutrition.fat}</strong>
                                <span>Fat</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-section">
                        <h3>üí° Chef's Tip</h3>
                        <p style="color: var(--text-secondary);">${recipe.tips}</p>
                    </div>
                </div>
            `;
        }

        async function toggleFavorite(recipe) {
            const existingFav = favorites.find(f => f.recipe.name === recipe.name);
            
            if (existingFav) {
                await db.collection('favorites').doc(existingFav.id).delete();
                favorites = favorites.filter(f => f.id !== existingFav.id);
                showNotification('Removed from favorites');
            } else {
                const docRef = await db.collection('favorites').add({
                    userId: currentUser.uid,
                    recipe: recipe,
                    date: new Date().toISOString()
                });
                favorites.push({ id: docRef.id, recipe, date: new Date().toISOString() });
                showNotification('Added to favorites! ‚≠ê');
            }
            
            displayRecipe(recipe);
            updateFavorites();
        }

        async function addToShopping(recipe) {
            recipe.ingredients.forEach(ing => {
                if (!shoppingList.find(item => item.name === ing)) {
                    shoppingList.push({ name: ing, checked: false });
                }
            });
            
            await db.collection('shopping').doc(currentUser.uid).set({
                items: shoppingList
            });
            
            showNotification('Added to shopping list! üõí');
            updateShoppingList();
        }

        function openPlannerModal(recipe) {
            currentRecipe = recipe;
            document.getElementById('planner-modal').classList.add('active');
        }

        async function addToMealPlan() {
            const day = document.getElementById('planner-day').value;
            const meal = document.getElementById('planner-meal').value;
            
            if (!mealPlan[day]) mealPlan[day] = {};
            mealPlan[day][meal] = currentRecipe;
            
            await db.collection('mealPlans').doc(currentUser.uid).set({
                plan: mealPlan
            });
            
            closeModal('planner-modal');
            showNotification('Added to meal plan! üìÖ');
            updateMealPlanner();
        }

        function shareRecipe(recipe) {
            const shareText = `Check out this ${recipe.name} recipe I made with Chef Genius Pro!

Ingredients: ${recipe.ingredients.join(', ')}

Difficulty: ${recipe.difficulty}
Cuisine: ${recipe.cuisine}`;

            if (navigator.share) {
                navigator.share({
                    title: recipe.name,
                    text: shareText
                }).catch(err => console.log('Error sharing:', err));
            } else {
                const shareContent = document.getElementById('share-content');
                shareContent.innerHTML = `
                    <textarea readonly style="width: 100%; height: 200px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 16px;">${shareText}</textarea>
                    <button class="btn-primary" onclick="copyShareText('${shareText.replace(/'/g, "\\'")}')">üìã Copy to Clipboard</button>
                `;
                document.getElementById('share-modal').classList.add('active');
            }
        }

        function copyShareText(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied to clipboard!');
                closeModal('share-modal');
            });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function updateHistory() {
            const historyList = document.getElementById('history-list');
            const searchTerm = document.getElementById('history-search').value.toLowerCase();
            
            const filteredRecipes = recipes.filter(r => 
                r.recipe.name.toLowerCase().includes(searchTerm) ||
                r.ingredients.toLowerCase().includes(searchTerm)
            );

            if (filteredRecipes.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <h3>No recipes found</h3>
                        <p>Try a different search or generate your first recipe!</p>
                    </div>
                `;
                return;
            }

            historyList.innerHTML = filteredRecipes.map(r => `
                <div class="history-item">
                    <div class="history-header">
                        <div class="history-title">
                            <h3>${r.recipe.name}</h3>
                            <div class="history-date">${new Date(r.date).toLocaleDateString('en-US', { 
                                year: 'numeric', 
                                month: 'short', 
                                day: 'numeric' 
                            })}</div>
                        </div>
                        <div class="history-actions">
                            <button class="icon-btn" onclick="viewRecipe('${r.id}')" title="View">üëÅÔ∏è</button>
                            <button class="icon-btn" onclick="deleteRecipe('${r.id}')" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                        <strong>Ingredients:</strong> ${r.ingredients}
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <span class="difficulty-badge difficulty-${r.recipe.difficulty.toLowerCase()}">${r.recipe.difficulty}</span>
                        <span style="font-size: 12px; padding: 6px 12px; background: var(--bg-secondary); border-radius: 6px;">üåç ${r.recipe.cuisine}</span>
                    </div>
                </div>
            `).join('');
        }

        function filterHistory() {
            updateHistory();
        }

        function viewRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;

            showPage('home');
            document.getElementById('ingredients').value = recipe.ingredients;
            currentRecipe = recipe.recipe;
            displayRecipe(recipe.recipe);
        }

        async function deleteRecipe(id) {
            if (!confirm('Delete this recipe?')) return;

            try {
                await db.collection('recipes').doc(id).delete();
                await loadRecipes();
                updateHistory();
                showNotification('Recipe deleted');
            } catch (error) {
                console.error('Error deleting recipe:', error);
                alert('Failed to delete recipe.');
            }
        }

        function updateFavorites() {
            const favoritesList = document.getElementById('favorites-list');

            if (favorites.length === 0) {
                favoritesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚≠ê</div>
                        <h3>No favorites yet</h3>
                        <p>Star your favorite recipes to see them here!</p>
                    </div>
                `;
                return;
            }

            favoritesList.innerHTML = favorites.map(f => `
                <div class="favorite-item">
                    <h3 style="font-size: 18px; margin-bottom: 8px;">‚≠ê ${f.recipe.name}</h3>
                    <div style="margin-bottom: 12px;">
                        <span class="difficulty-badge difficulty-${f.recipe.difficulty.toLowerCase()}">${f.recipe.difficulty}</span>
                        <span style="font-size: 12px; padding: 6px 12px; background: var(--bg-secondary); border-radius: 6px; margin-left: 8px;">üåç ${f.recipe.cuisine}</span>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="icon-btn" onclick="viewFavorite('${f.id}')">üëÅÔ∏è View</button>
                        <button class="icon-btn" onclick="removeFavorite('${f.id}')">üóëÔ∏è Remove</button>
                    </div>
                </div>
            `).join('');
        }

        function viewFavorite(id) {
            const favorite = favorites.find(f => f.id === id);
            if (!favorite) return;

            showPage('home');
            currentRecipe = favorite.recipe;
            displayRecipe(favorite.recipe);
        }

        async function removeFavorite(id) {
            if (!confirm('Remove from favorites?')) return;

            try {
                await db.collection('favorites').doc(id).delete();
                await loadFavorites();
                updateFavorites();
                showNotification('Removed from favorites');
            } catch (error) {
                console.error('Error removing favorite:', error);
            }
        }

        function updateShoppingList() {
            const shoppingDiv = document.getElementById('shopping-list');

            if (shoppingList.length === 0) {
                shoppingDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <h3>Shopping list is empty</h3>
                        <p>Add ingredients from your recipes!</p>
                    </div>
                `;
                return;
            }

            shoppingDiv.innerHTML = shoppingList.map((item, i) => `
                <div class="shopping-item ${item.checked ? 'checked' : ''}">
                    <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggleShoppingItem(${i})">
                    <span>${item.name}</span>
                </div>
            `).join('');
        }

        async function toggleShoppingItem(index) {
            shoppingList[index].checked = !shoppingList[index].checked;
            await db.collection('shopping').doc(currentUser.uid).set({
                items: shoppingList
            });
            updateShoppingList();
        }

        async function clearShoppingList() {
            if (!confirm('Clear all checked items?')) return;

            shoppingList = shoppingList.filter(item => !item.checked);
            await db.collection('shopping').doc(currentUser.uid).set({
                items: shoppingList
            });
            updateShoppingList();
            showNotification('Cleared checked items');
        }

        function updateMealPlanner() {
            const plannerDiv = document.getElementById('meal-planner');
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const meals = ['breakfast', 'lunch', 'dinner'];

            plannerDiv.innerHTML = days.map(day => {
                const dayPlan = mealPlan[day] || {};
                return `
                    <div class="day-card">
                        <h3>${day.charAt(0).toUpperCase() + day.slice(1)}</h3>
                        ${meals.map(meal => {
                            const recipe = dayPlan[meal];
                            if (recipe) {
                                return `
                                    <div class="meal-slot">
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">${meal.toUpperCase()}</div>
                                        <div style="font-weight: 600;">${recipe.name}</div>
                                        <button class="icon-btn" style="margin-top: 8px; padding: 6px 12px; font-size: 12px;" onclick="removeMealPlan('${day}', '${meal}')">üóëÔ∏è Remove</button>
                                    </div>
                                `;
                            } else {
                                return `<div class="meal-slot empty">${meal} - Click to add</div>`;
                            }
                        }).join('')}
                    </div>
                `;
            }).join('');
        }

        async function removeMealPlan(day, meal) {
            if (!confirm('Remove this meal from your plan?')) return;

            if (mealPlan[day]) {
                delete mealPlan[day][meal];
            }

            await db.collection('mealPlans').doc(currentUser.uid).set({
                plan: mealPlan
            });

            updateMealPlanner();
            showNotification('Meal removed from plan');
        }

        // Timer Functions
        function setTimerPreset(minutes) {
            document.getElementById('timer-input').value = minutes;
            timerDuration = minutes * 60;
            timerSeconds = 0;
            updateTimerDisplay();
        }

        function startTimer() {
            if (timerInterval) return;

            if (timerSeconds === 0) {
                const minutes = parseInt(document.getElementById('timer-input').value) || 25;
                timerDuration = minutes * 60;
                timerSeconds = timerDuration;
            }

            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();

                if (timerSeconds <= 0) {
                    pauseTimer();
                    showNotification('‚è∞ Timer finished!');
                    playTimerSound();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function resetTimer() {
            pauseTimer();
            timerSeconds = 0;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timer-display').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function playTimerSound() {
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification("Chef Genius Pro", {
                    body: "Your cooking timer has finished!",
                    icon: "üë®‚Äçüç≥"
                });
            }
        }

        function updateProfile() {
            if (!userProfile) return;

            const profileDisplay = document.getElementById('profile-display');
            const isPremium = userProfile.plan === 'premium';

            profileDisplay.innerHTML = `
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            ${currentUser.photoURL ? 
                                `<img src="${currentUser.photoURL}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" alt="Profile">` : 
                                'üë§'
                            }
                        </div>
                        <div class="profile-info">
                            <h2>${currentUser.displayName || 'Chef'}</h2>
                            <p>${userProfile.email}</p>
                        </div>
                    </div>
                    
                    <span class="plan-badge ${isPremium ? 'premium' : 'free'}">
                        ${isPremium ? '‚≠ê PREMIUM CHEF' : 'üÜì FREE PLAN'}
                    </span>
                    
                    <div class="plan-stats">
                        <div class="stat-item">
                            <h4>${userProfile.generationsUsed}</h4>
                            <p>Recipes Generated</p>
                        </div>
                        <div class="stat-item">
                            <h4>${recipes.length}</h4>
                            <p>Total Recipes</p>
                        </div>
                        <div class="stat-item">
                            <h4>${favorites.length}</h4>
                            <p>Favorites</p>
                        </div>
                        <div class="stat-item">
                            <h4>${Object.keys(mealPlan).length}</h4>
                            <p>Meal Plans</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function initiatePayment() {
            alert('üéâ Payment Integration\n\nFlutterwave payment would be initialized here.\n\nFor demo: Plan upgraded to Premium!\n\nYou now have access to all premium features!');
            
            userProfile.plan = 'premium';
            userProfile.generationsLimit = 30;
            db.collection('users').doc(currentUser.uid).update({
                plan: 'premium',
                generationsLimit: 30
            });
            
            updateProfile();
            updateUI();
            showPage('profile');
            showNotification('Welcome to Premium! üåü');
        }

        function showNotification(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-success';
            alert.textContent = message;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.left = '50%';
            alert.style.transform = 'translateX(-50%)';
            alert.style.zIndex = '10000';
            alert.style.minWidth = '200px';
            alert.style.textAlign = 'center';
            alert.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.transition = 'opacity 0.3s';
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            }, 3000);
        }

        // Install PWA prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            const installBanner = document.createElement('div');
            installBanner.innerHTML = `
                <div style="position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); max-width: 400px; background: var(--primary); color: white; padding: 16px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000;">
                    <p style="margin-bottom: 12px; font-weight: 600;">üì± Install Chef Genius Pro</p>
                    <p style="font-size: 14px; margin-bottom: 12px; opacity: 0.9;">Get quick access and use offline!</p>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="installPWA()" style="flex: 1; padding: 10px; background: white; color: var(--primary); border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">Install</button>
                        <button onclick="this.parentElement.parentElement.remove()" style="padding: 10px 16px; background: transparent; color: white; border: 1px solid white; border-radius: 6px; font-weight: 600; cursor: pointer;">Later</button>
                    </div>
                </div>
            `;
            document.body.appendChild(installBanner);
        });

        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    showNotification('Thanks for installing! üéâ');
                }
                deferredPrompt = null;
            }
        }
    </script>
</body>
</html>
